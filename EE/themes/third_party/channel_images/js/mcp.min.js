(function(n,e){"use strict";function t(){u.find(".select2").select2(),u.find(".start_actions").click(o),m.bind("keyup change",i).trigger("change"),y.bind("click",a).find("input:checked").trigger("click"),v.bind("click",r).find("input:checked").trigger("click"),j.delegate(".show_error","click",l)}function i(){var n=m.find(":input").serializeArray();n.push({name:"ajax_method",value:"load_batch_images"}),n.push({name:"site_id",value:ChannelImages.site_id}),e.ajax({url:ChannelImages.AJAX_URL,type:"POST",dataType:"json",data:n,success:function(n){g=n.ids,p=g.length,u.find(".total_count").html(p)},error:function(){}})}function a(){f=y.find("input:checked").val(),u.find("table.actions").hide(),u.find("table.action-"+f).show()}function r(){var n=v.find("input:checked").val();u.find("tbody.options").hide(),u.find("tbody.option-"+n).show()}function o(n,e){h||"transfer"!=f||(h=u.find(".action-transfer").find(":input").serializeArray());for(var t=0;g.length>t;t++)if(g[t]&&!g[t].done)return e||(e=j.find(".current-actions").append("<tr></tr>").find("tr:last")),c(t,e),void 0;s(null,e,!0)}function c(n,t){var i=[];"transfer"==f&&(i=h),i.push({name:"id",value:g[n].id}),i.push({name:"action",value:f}),i.push({name:"ajax_method",value:"exec_batch"}),g[n].done=!0,g[n].loading=!0,s(n,t),e.ajax({url:ChannelImages.AJAX_URL+"&image_id="+g[n].id,type:"POST",dataType:"json",data:i,success:function(){d(n,t)},error:function(e){d(n,t,e)}})}function d(n,t,i){var a;return i?(e.ajax({url:ChannelImages.AJAX_URL,type:"POST",dataType:"json",data:{ajax_method:"get_image_details",id:g[n].id},success:function(e){g[n].entry=e.entry,g[n].channel=e.channel,g[n].field=e.field,g[n].image=e.image,g[n].ajax_error=i.responseText,g[n].loading=!1,g[n].retry_count?g[n].retry_count--:g[n].retry_count=3,g[n].retry=g[n].retry_count?!0:!1,s(n,t),g[n].retry&&setTimeout(function(){g[n].ajax_error=!1,c(n,t)},3e3)}}),void 0):(_.push(g[n].id),a=100/p*_.length,j.find(".progress").css("width",a+"%").find(".total_done").html(_.length),o(null,t),delete g[n],void 0)}function s(n,e,t){var i;i=t?{action_done:!0}:g[n],e.html(ChannelImages.Templates.mcp_batch_action_row(i))}function l(n){var t=e(n.target).closest(".action_error").find("script").html();e("#ci_ajax_error").show().find("iframe").contents().find("html").html(t)}var ChannelImages=n.ChannelImages=n.ChannelImages||{},u=e("#cimcp");if(u.length>0){var f,h,g=[],_=[],p=0,m=u.find(".image-filters"),y=u.find(".action-toggler"),v=u.find(".transfer-toggle"),j=u.find(".progress_holder");t()}})(window,jQuery);
//@ sourceMappingURL=/themes/third_party/channel_images/js/mcp.min.map